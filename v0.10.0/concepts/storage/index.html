<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.104.3"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/kcp/favicons/favicon.ico><link rel=apple-touch-icon href=/kcp/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/kcp/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/kcp/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/kcp/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/kcp/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/kcp/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/kcp/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/kcp/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/kcp/favicons/android-192x192.png sizes=192x192><title>kcp - a multi-tenant control plane for Kubernetes APIs</title><meta name=description content="Storage and stateful applications
Overview
KCP provides a control plane that implements the concept of Transparent Multi Cluster (TMC) for compute, …"><meta property="og:title" content><meta property="og:description" content="Storage and stateful applications Overview KCP provides a control plane that implements the concept of Transparent Multi Cluster (TMC) for compute, network, and storage. In order to give the illusion of transparent storage in KCP, it exposes the same Kubernetes APIs for storage (PVC/PV), so users and workloads do not need to be aware of the coordinations taken by the control plane behind the scenes.
Placement for storage in KCP uses the same concepts used for compute: &ldquo;SyncTargets in a Location are transparent to the user, and workloads should be able to seamlessly move from one SyncTarget to another within a Location, based on operational concerns of the compute service provider, like decommissioning a cluster, rebalancing capacity, or due to an outage of a cluster."><meta property="og:type" content="article"><meta property="og:url" content="http://kcp-dev.github.io/kcp/v0.10.0/concepts/storage/"><meta property="article:section" content="v0.10.0"><meta property="og:site_name" content="kcp - a multi-tenant control plane for Kubernetes APIs"><meta itemprop=name content><meta itemprop=description content="Storage and stateful applications Overview KCP provides a control plane that implements the concept of Transparent Multi Cluster (TMC) for compute, network, and storage. In order to give the illusion of transparent storage in KCP, it exposes the same Kubernetes APIs for storage (PVC/PV), so users and workloads do not need to be aware of the coordinations taken by the control plane behind the scenes.
Placement for storage in KCP uses the same concepts used for compute: &ldquo;SyncTargets in a Location are transparent to the user, and workloads should be able to seamlessly move from one SyncTarget to another within a Location, based on operational concerns of the compute service provider, like decommissioning a cluster, rebalancing capacity, or due to an outage of a cluster."><meta itemprop=wordCount content="2183"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Storage and stateful applications Overview KCP provides a control plane that implements the concept of Transparent Multi Cluster (TMC) for compute, network, and storage. In order to give the illusion of transparent storage in KCP, it exposes the same Kubernetes APIs for storage (PVC/PV), so users and workloads do not need to be aware of the coordinations taken by the control plane behind the scenes.
Placement for storage in KCP uses the same concepts used for compute: &ldquo;SyncTargets in a Location are transparent to the user, and workloads should be able to seamlessly move from one SyncTarget to another within a Location, based on operational concerns of the compute service provider, like decommissioning a cluster, rebalancing capacity, or due to an outage of a cluster."><link rel=preload href=/kcp/scss/main.min.880f3e686065cfc264f99718116b68f6dfda007cc1822be21ff6d89ad5db883b.css as=style><link href=/kcp/scss/main.min.880f3e686065cfc264f99718116b68f6dfda007cc1822be21ff6d89ad5db883b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-sm-row td-navbar"><a class="navbar-brand mr-2" style=display:flex;justify-content:center href=https://kcp.io><img class=navbar-logo src=/kcp/logo.png width=38px alt=logo></a>
<a class=navbar-brand style=display:flex;justify-content:center href=https://kcp.io><span class="font-weight-bold d-none d-sm-inline d-lg-none" style=font-size:.875rem>kcp</span>
<span class="font-weight-bold d-none d-lg-inline">kcp</span></a><div class="td-navbar-nav-scroll ml-sm-auto mt-0" id=main_navbar><ul class="navbar-nav mt-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://docs.kcp.io/kcp/main><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://kcp.io/blog><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/kcp-dev/kcp/blob/main/CONTRIBUTING.md><span>Contribute</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/kcp-dev/kcp/><span>GitHub</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=https://kcp-dev.github.io/kcp/main>main</a>
<a class=dropdown-item href=https://kcp-dev.github.io/kcp/v0.10.0>v0.10.0</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-kcpv0100-li><a href=/kcp/v0.10.0/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-kcpv0100><span>kcp Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-kcpv0100concepts-li><input type=checkbox id=m-kcpv0100concepts-check checked>
<label for=m-kcpv0100concepts-check><a href=/kcp/v0.10.0/concepts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-kcpv0100concepts><span>kcp Concepts</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsauthorization-li><input type=checkbox id=m-kcpv0100conceptsauthorization-check>
<label for=m-kcpv0100conceptsauthorization-check><a href=/kcp/v0.10.0/concepts/authorization/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsauthorization><span>Authorization</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptscache-server-li><input type=checkbox id=m-kcpv0100conceptscache-server-check>
<label for=m-kcpv0100conceptscache-server-check><a href=/kcp/v0.10.0/concepts/cache-server/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptscache-server><span>Cache Server</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptscluster-mapper-li><input type=checkbox id=m-kcpv0100conceptscluster-mapper-check>
<label for=m-kcpv0100conceptscluster-mapper-check><a href=/kcp/v0.10.0/concepts/cluster-mapper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptscluster-mapper><span>Cluster Mapper</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptskubectl-kcp-plugin-li><input type=checkbox id=m-kcpv0100conceptskubectl-kcp-plugin-check>
<label for=m-kcpv0100conceptskubectl-kcp-plugin-check><a href=/kcp/v0.10.0/concepts/kubectl-kcp-plugin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptskubectl-kcp-plugin><span>Kubectl kcp plugin</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptslocations-and-scheduling-li><input type=checkbox id=m-kcpv0100conceptslocations-and-scheduling-check>
<label for=m-kcpv0100conceptslocations-and-scheduling-check><a href=/kcp/v0.10.0/concepts/locations-and-scheduling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptslocations-and-scheduling><span>Placement, Locations and Scheduling</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptssyncer-li><input type=checkbox id=m-kcpv0100conceptssyncer-check>
<label for=m-kcpv0100conceptssyncer-check><a href=/kcp/v0.10.0/concepts/syncer/ title="Registering Kubernetes Clusters using syncer" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptssyncer><span>Syncer</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsquickstart-tenancy-and-apis-li><input type=checkbox id=m-kcpv0100conceptsquickstart-tenancy-and-apis-check>
<label for=m-kcpv0100conceptsquickstart-tenancy-and-apis-check><a href=/kcp/v0.10.0/concepts/quickstart-tenancy-and-apis/ title="Quickstart: Tenancy and APIs" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsquickstart-tenancy-and-apis><span>Tenancy and APIs</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsconcepts-li><input type=checkbox id=m-kcpv0100conceptsconcepts-check>
<label for=m-kcpv0100conceptsconcepts-check><a href=/kcp/v0.10.0/concepts/concepts/ title="Terminology for kcp" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsconcepts><span>Terminology</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsvirtual-workspaces-li><input type=checkbox id=m-kcpv0100conceptsvirtual-workspaces-check>
<label for=m-kcpv0100conceptsvirtual-workspaces-check><a href=/kcp/v0.10.0/concepts/virtual-workspaces/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsvirtual-workspaces><span>Virtual Workspaces</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsworkspaces-li><input type=checkbox id=m-kcpv0100conceptsworkspaces-check>
<label for=m-kcpv0100conceptsworkspaces-check><a href=/kcp/v0.10.0/concepts/workspaces/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsworkspaces><span>Workspaces</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-kcpv0100conceptsdevelopers-li><input type=checkbox id=m-kcpv0100conceptsdevelopers-check>
<label for=m-kcpv0100conceptsdevelopers-check><a href=/kcp/v0.10.0/concepts/developers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-kcpv0100conceptsdevelopers><span>Developers</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsdeveloperscontrollers-li><input type=checkbox id=m-kcpv0100conceptsdeveloperscontrollers-check>
<label for=m-kcpv0100conceptsdeveloperscontrollers-check><a href=/kcp/v0.10.0/concepts/developers/controllers/ title="Writing kcp-aware controllers" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsdeveloperscontrollers><span>kcp-aware controllers</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsdeveloperslibrary-usage-li><input type=checkbox id=m-kcpv0100conceptsdeveloperslibrary-usage-check>
<label for=m-kcpv0100conceptsdeveloperslibrary-usage-check><a href=/kcp/v0.10.0/concepts/developers/library-usage/ title="Using kcp as a library" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsdeveloperslibrary-usage><span>Library Usage</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsdevelopersreleasing-li><input type=checkbox id=m-kcpv0100conceptsdevelopersreleasing-check>
<label for=m-kcpv0100conceptsdevelopersreleasing-check><a href=/kcp/v0.10.0/concepts/developers/releasing/ title="Publishing a new kcp release" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsdevelopersreleasing><span>Publishing</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-kcpv0100conceptsinvestigations-li><input type=checkbox id=m-kcpv0100conceptsinvestigations-check>
<label for=m-kcpv0100conceptsinvestigations-check><a href=/kcp/v0.10.0/concepts/investigations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-kcpv0100conceptsinvestigations><span>Investigations</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsinvestigationslogical-clusters-li><input type=checkbox id=m-kcpv0100conceptsinvestigationslogical-clusters-check>
<label for=m-kcpv0100conceptsinvestigationslogical-clusters-check><a href=/kcp/v0.10.0/concepts/investigations/logical-clusters/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsinvestigationslogical-clusters><span>Logical clusters</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsinvestigationsminimal-api-server-li><input type=checkbox id=m-kcpv0100conceptsinvestigationsminimal-api-server-check>
<label for=m-kcpv0100conceptsinvestigationsminimal-api-server-check><a href=/kcp/v0.10.0/concepts/investigations/minimal-api-server/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsinvestigationsminimal-api-server><span>Minimal API Server</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsinvestigationsself-service-policy-li><input type=checkbox id=m-kcpv0100conceptsinvestigationsself-service-policy-check>
<label for=m-kcpv0100conceptsinvestigationsself-service-policy-check><a href=/kcp/v0.10.0/concepts/investigations/self-service-policy/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsinvestigationsself-service-policy><span>Self-service policy</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100conceptsinvestigationstransparent-multi-cluster-li><input type=checkbox id=m-kcpv0100conceptsinvestigationstransparent-multi-cluster-check>
<label for=m-kcpv0100conceptsinvestigationstransparent-multi-cluster-check><a href=/kcp/v0.10.0/concepts/investigations/transparent-multi-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsinvestigationstransparent-multi-cluster><span>Transparent multi-cluster</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-kcpv0100conceptsstorage-li><input type=checkbox id=m-kcpv0100conceptsstorage-check checked>
<label for=m-kcpv0100conceptsstorage-check><a href=/kcp/v0.10.0/concepts/storage/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-kcpv0100conceptsstorage><span class=td-sidebar-nav-active-item></span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-kcpv0100cli-li><input type=checkbox id=m-kcpv0100cli-check>
<label for=m-kcpv0100cli-check><a href=/kcp/v0.10.0/cli/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-kcpv0100cli><span>CLI Reference</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp-li><input type=checkbox id=m-kcpv0100clikcp-check>
<label for=m-kcpv0100clikcp-check><a href=/kcp/v0.10.0/cli/kcp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp><span>kcp</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_bind-li><input type=checkbox id=m-kcpv0100clikcp_bind-check>
<label for=m-kcpv0100clikcp_bind-check><a href=/kcp/v0.10.0/cli/kcp_bind/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_bind><span>kcp bind</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_bind_apiexport-li><input type=checkbox id=m-kcpv0100clikcp_bind_apiexport-check>
<label for=m-kcpv0100clikcp_bind_apiexport-check><a href=/kcp/v0.10.0/cli/kcp_bind_apiexport/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_bind_apiexport><span>kcp bind apiexport</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_bind_compute-li><input type=checkbox id=m-kcpv0100clikcp_bind_compute-check>
<label for=m-kcpv0100clikcp_bind_compute-check><a href=/kcp/v0.10.0/cli/kcp_bind_compute/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_bind_compute><span>kcp bind compute</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_claims-li><input type=checkbox id=m-kcpv0100clikcp_claims-check>
<label for=m-kcpv0100clikcp_claims-check><a href=/kcp/v0.10.0/cli/kcp_claims/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_claims><span>kcp claims</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_claims_get-li><input type=checkbox id=m-kcpv0100clikcp_claims_get-check>
<label for=m-kcpv0100clikcp_claims_get-check><a href=/kcp/v0.10.0/cli/kcp_claims_get/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_claims_get><span>kcp claims get</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_claims_get_apibinding-li><input type=checkbox id=m-kcpv0100clikcp_claims_get_apibinding-check>
<label for=m-kcpv0100clikcp_claims_get_apibinding-check><a href=/kcp/v0.10.0/cli/kcp_claims_get_apibinding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_claims_get_apibinding><span>kcp claims get apibinding</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_crd-li><input type=checkbox id=m-kcpv0100clikcp_crd-check>
<label for=m-kcpv0100clikcp_crd-check><a href=/kcp/v0.10.0/cli/kcp_crd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_crd><span>kcp crd</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_crd_snapshot-li><input type=checkbox id=m-kcpv0100clikcp_crd_snapshot-check>
<label for=m-kcpv0100clikcp_crd_snapshot-check><a href=/kcp/v0.10.0/cli/kcp_crd_snapshot/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_crd_snapshot><span>kcp crd snapshot</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workload-li><input type=checkbox id=m-kcpv0100clikcp_workload-check>
<label for=m-kcpv0100clikcp_workload-check><a href=/kcp/v0.10.0/cli/kcp_workload/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workload><span>kcp workload</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workload_cordon-li><input type=checkbox id=m-kcpv0100clikcp_workload_cordon-check>
<label for=m-kcpv0100clikcp_workload_cordon-check><a href=/kcp/v0.10.0/cli/kcp_workload_cordon/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workload_cordon><span>kcp workload cordon</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workload_drain-li><input type=checkbox id=m-kcpv0100clikcp_workload_drain-check>
<label for=m-kcpv0100clikcp_workload_drain-check><a href=/kcp/v0.10.0/cli/kcp_workload_drain/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workload_drain><span>kcp workload drain</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workload_sync-li><input type=checkbox id=m-kcpv0100clikcp_workload_sync-check>
<label for=m-kcpv0100clikcp_workload_sync-check><a href=/kcp/v0.10.0/cli/kcp_workload_sync/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workload_sync><span>kcp workload sync</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workload_uncordon-li><input type=checkbox id=m-kcpv0100clikcp_workload_uncordon-check>
<label for=m-kcpv0100clikcp_workload_uncordon-check><a href=/kcp/v0.10.0/cli/kcp_workload_uncordon/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workload_uncordon><span>kcp workload uncordon</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workspace-li><input type=checkbox id=m-kcpv0100clikcp_workspace-check>
<label for=m-kcpv0100clikcp_workspace-check><a href=/kcp/v0.10.0/cli/kcp_workspace/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workspace><span>kcp workspace</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workspace_create-li><input type=checkbox id=m-kcpv0100clikcp_workspace_create-check>
<label for=m-kcpv0100clikcp_workspace_create-check><a href=/kcp/v0.10.0/cli/kcp_workspace_create/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workspace_create><span>kcp workspace create</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workspace_create-context-li><input type=checkbox id=m-kcpv0100clikcp_workspace_create-context-check>
<label for=m-kcpv0100clikcp_workspace_create-context-check><a href=/kcp/v0.10.0/cli/kcp_workspace_create-context/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workspace_create-context><span>kcp workspace create-context</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workspace_current-li><input type=checkbox id=m-kcpv0100clikcp_workspace_current-check>
<label for=m-kcpv0100clikcp_workspace_current-check><a href=/kcp/v0.10.0/cli/kcp_workspace_current/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workspace_current><span>kcp workspace current</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workspace_tree-li><input type=checkbox id=m-kcpv0100clikcp_workspace_tree-check>
<label for=m-kcpv0100clikcp_workspace_tree-check><a href=/kcp/v0.10.0/cli/kcp_workspace_tree/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workspace_tree><span>kcp workspace tree</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100clikcp_workspace_use-li><input type=checkbox id=m-kcpv0100clikcp_workspace_use-check>
<label for=m-kcpv0100clikcp_workspace_use-check><a href=/kcp/v0.10.0/cli/kcp_workspace_use/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100clikcp_workspace_use><span>kcp workspace use</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-kcpv0100crd-reference-li><input type=checkbox id=m-kcpv0100crd-reference-check>
<label for=m-kcpv0100crd-reference-check><a href=/kcp/v0.10.0/crd-reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-kcpv0100crd-reference><span>CRD Reference</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceapibindingsapiskcpio-li><input type=checkbox id=m-kcpv0100crd-referenceapibindingsapiskcpio-check>
<label for=m-kcpv0100crd-referenceapibindingsapiskcpio-check><a href=/kcp/v0.10.0/crd-reference/apibindings.apis.kcp.io/ title="APIBinding CRD schema reference (group apis.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceapibindingsapiskcpio><span>APIBinding</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceapiexportsapiskcpio-li><input type=checkbox id=m-kcpv0100crd-referenceapiexportsapiskcpio-check>
<label for=m-kcpv0100crd-referenceapiexportsapiskcpio-check><a href=/kcp/v0.10.0/crd-reference/apiexports.apis.kcp.io/ title="APIExport CRD schema reference (group apis.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceapiexportsapiskcpio><span>APIExport</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceapiexportendpointslicesapiskcpio-li><input type=checkbox id=m-kcpv0100crd-referenceapiexportendpointslicesapiskcpio-check>
<label for=m-kcpv0100crd-referenceapiexportendpointslicesapiskcpio-check><a href=/kcp/v0.10.0/crd-reference/apiexportendpointslices.apis.kcp.io/ title="APIExportEndpointSlice CRD schema reference (group apis.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceapiexportendpointslicesapiskcpio><span>APIExportEndpointSlice</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceapiresourceimportsapiresourcekcpio-li><input type=checkbox id=m-kcpv0100crd-referenceapiresourceimportsapiresourcekcpio-check>
<label for=m-kcpv0100crd-referenceapiresourceimportsapiresourcekcpio-check><a href=/kcp/v0.10.0/crd-reference/apiresourceimports.apiresource.kcp.io/ title="APIResourceImport CRD schema reference (group apiresource.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceapiresourceimportsapiresourcekcpio><span>APIResourceImport</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceapiresourceschemasapiskcpio-li><input type=checkbox id=m-kcpv0100crd-referenceapiresourceschemasapiskcpio-check>
<label for=m-kcpv0100crd-referenceapiresourceschemasapiskcpio-check><a href=/kcp/v0.10.0/crd-reference/apiresourceschemas.apis.kcp.io/ title="APIResourceSchema CRD schema reference (group apis.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceapiresourceschemasapiskcpio><span>APIResourceSchema</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referencelocationsschedulingkcpio-li><input type=checkbox id=m-kcpv0100crd-referencelocationsschedulingkcpio-check>
<label for=m-kcpv0100crd-referencelocationsschedulingkcpio-check><a href=/kcp/v0.10.0/crd-reference/locations.scheduling.kcp.io/ title="Location CRD schema reference (group scheduling.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referencelocationsschedulingkcpio><span>Location</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referencelogicalclusterscorekcpio-li><input type=checkbox id=m-kcpv0100crd-referencelogicalclusterscorekcpio-check>
<label for=m-kcpv0100crd-referencelogicalclusterscorekcpio-check><a href=/kcp/v0.10.0/crd-reference/logicalclusters.core.kcp.io/ title="LogicalCluster CRD schema reference (group core.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referencelogicalclusterscorekcpio><span>LogicalCluster</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referencenegotiatedapiresourcesapiresourcekcpio-li><input type=checkbox id=m-kcpv0100crd-referencenegotiatedapiresourcesapiresourcekcpio-check>
<label for=m-kcpv0100crd-referencenegotiatedapiresourcesapiresourcekcpio-check><a href=/kcp/v0.10.0/crd-reference/negotiatedapiresources.apiresource.kcp.io/ title="NegotiatedAPIResource CRD schema reference (group apiresource.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referencenegotiatedapiresourcesapiresourcekcpio><span>NegotiatedAPIResource</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referencepartitionstopologykcpio-li><input type=checkbox id=m-kcpv0100crd-referencepartitionstopologykcpio-check>
<label for=m-kcpv0100crd-referencepartitionstopologykcpio-check><a href=/kcp/v0.10.0/crd-reference/partitions.topology.kcp.io/ title="Partition CRD schema reference (group topology.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referencepartitionstopologykcpio><span>Partition</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referencepartitionsetstopologykcpio-li><input type=checkbox id=m-kcpv0100crd-referencepartitionsetstopologykcpio-check>
<label for=m-kcpv0100crd-referencepartitionsetstopologykcpio-check><a href=/kcp/v0.10.0/crd-reference/partitionsets.topology.kcp.io/ title="PartitionSet CRD schema reference (group topology.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referencepartitionsetstopologykcpio><span>PartitionSet</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceplacementsschedulingkcpio-li><input type=checkbox id=m-kcpv0100crd-referenceplacementsschedulingkcpio-check>
<label for=m-kcpv0100crd-referenceplacementsschedulingkcpio-check><a href=/kcp/v0.10.0/crd-reference/placements.scheduling.kcp.io/ title="Placement CRD schema reference (group scheduling.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceplacementsschedulingkcpio><span>Placement</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceshardscorekcpio-li><input type=checkbox id=m-kcpv0100crd-referenceshardscorekcpio-check>
<label for=m-kcpv0100crd-referenceshardscorekcpio-check><a href=/kcp/v0.10.0/crd-reference/shards.core.kcp.io/ title="Shard CRD schema reference (group core.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceshardscorekcpio><span>Shard</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referencesynctargetsworkloadkcpio-li><input type=checkbox id=m-kcpv0100crd-referencesynctargetsworkloadkcpio-check>
<label for=m-kcpv0100crd-referencesynctargetsworkloadkcpio-check><a href=/kcp/v0.10.0/crd-reference/synctargets.workload.kcp.io/ title="SyncTarget CRD schema reference (group workload.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referencesynctargetsworkloadkcpio><span>SyncTarget</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceworkspacestenancykcpio-li><input type=checkbox id=m-kcpv0100crd-referenceworkspacestenancykcpio-check>
<label for=m-kcpv0100crd-referenceworkspacestenancykcpio-check><a href=/kcp/v0.10.0/crd-reference/workspaces.tenancy.kcp.io/ title="Workspace CRD schema reference (group tenancy.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceworkspacestenancykcpio><span>Workspace</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-kcpv0100crd-referenceworkspacetypestenancykcpio-li><input type=checkbox id=m-kcpv0100crd-referenceworkspacetypestenancykcpio-check>
<label for=m-kcpv0100crd-referenceworkspacetypestenancykcpio-check><a href=/kcp/v0.10.0/crd-reference/workspacetypes.tenancy.kcp.io/ title="WorkspaceType CRD schema reference (group tenancy.kcp.io)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-kcpv0100crd-referenceworkspacetypestenancykcpio><span>WorkspaceType</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/kcp-dev/kcp/tree/main/docs/content/en/v0.10.0/concepts/storage.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/kcp-dev/kcp/edit/main/docs/content/en/v0.10.0/concepts/storage.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/kcp-dev/kcp/new/main/docs/content/en/v0.10.0/concepts/storage.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/kcp-dev/kcp/issues/new?title=" class=td-page-meta--issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/kcp-dev/kcp/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#main-concepts>Main concepts</a></li><li><a href=#volume-types>Volume types</a><ul><li></li></ul></li><li><a href=#topology-and-locations>Topology and locations</a><ul><li></li></ul></li><li><a href=#provisioning-volumes>Provisioning volumes</a></li><li><a href=#moving-shared-volumes>Moving shared volumes</a></li><li><a href=#moving-owned-volumes>Moving owned volumes</a><ul><li></li></ul></li><li><a href=#storage-classes>Storage classes</a><ul><li></li></ul></li><li><a href=#deleting-volumes>Deleting volumes</a></li><li><a href=#copying-volumes>Copying volumes</a></li><li><a href=#disaster-recovery>Disaster recovery</a></li><li><a href=#examples>Examples</a><ul><li></li></ul></li><li><a href=#roadmap>Roadmap</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class="pageinfo pageinfo-primary"><p>Version v0.10.0 of the
documentation is no longer actively maintained. The site that you are
currently viewing is an archived snapshot.
For up-to-date documentation, see the
<a href=https://kcp-dev.github.io/kcp/main target=_blank>latest version</a>.</p></div><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=http://kcp-dev.github.io/kcp/v0.10.0/>kcp Documentation</a></li><li class=breadcrumb-item><a href=http://kcp-dev.github.io/kcp/v0.10.0/concepts/>kcp Concepts</a></li><li class="breadcrumb-item active" aria-current=page><a href=http://kcp-dev.github.io/kcp/v0.10.0/concepts/storage/ aria-disabled=true class="btn-link disabled"></a></li></ol></nav><div class=td-content><h1></h1><header class=article-meta></header><h1 id=storage-and-stateful-applications>Storage and stateful applications</h1><h2 id=overview>Overview</h2><p>KCP provides a control plane that implements the concept of Transparent Multi Cluster (TMC) for compute, network, and storage. In order to give the illusion of transparent storage in KCP, it exposes the same Kubernetes APIs for storage (PVC/PV), so users and workloads do not need to be aware of the coordinations taken by the control plane behind the scenes.</p><p>Placement for storage in KCP uses the same <a href=/kcp/v0.10.0/concepts/locations-and-scheduling/>concepts used for compute</a>: &ldquo;<code>SyncTargets</code> in a <code>Location</code> are transparent to the user, and workloads should be able to seamlessly move from one <code>SyncTarget</code> to another within a <code>Location</code>, based on operational concerns of the compute service provider, like decommissioning a cluster, rebalancing capacity, or due to an outage of a cluster. It is the compute service&rsquo;s responsibility to ensure that for workloads in a location, to the user it looks like ONE cluster.&rdquo;</p><p>KCP will provide the basic controllers and coordination logic for moving volumes, as efficiently as possible, using the underlying storage topology and capabilities. It will use the <code>SyncTargets</code> storage APIs to manage volumes, and not require direct access from the control plane to the storage itself. For more advanced or custom solutions, KCP will allow external coordinators to take over.</p><h2 id=main-concepts>Main concepts</h2><ul><li><p><a href=/kcp/v0.10.0/concepts/investigations/transparent-multi-cluster/>Transparent multi-cluster</a> - describes the TMC concepts.</p></li><li><p><a href=/kcp/v0.10.0/concepts/locations-and-scheduling/>Placement, Locations and Scheduling</a> - describes the KCP APIs and mechanisms used to control compute placement, which will be used for storage as well. Refer to the concepts of <code>SyncTarget</code>, <code>Location</code>, and <code>Placement</code>.</p></li><li><p><a href>Kubernetes storage concepts</a> - documentation of storage APIs in Kubernetes.</p></li><li><p><a href>Persistent Volumes</a> - PVCs are the main storage APIs used to request storage resources for applications. PVs are invisible to users, and used by administrators or privileged controllers to provision storage to user claims, and will be coordinated by KCP to support transparent multi-cluster storage.</p></li><li><p><a href>Kubernetes CSI</a> - The Container Storage Interface (CSI) is a standard for exposing arbitrary block and file storage systems to containerized workloads. The list of <a href>drivers</a> provides a &ldquo;menu&rdquo; of storage systems integrated with kubernetes and their properties.</p></li><li><p><a href>StatefulSets volumeClaimTemplates</a> - workload definition used to manage “sharded” stateful applications. Specifying <code>volumeClaimTemplates</code> in the statefulset spec will provide stable storage by creating a PVC per instance.</p></li></ul><h2 id=volume-types>Volume types</h2><p>Each physical-cluster (aka &ldquo;pcluster&rdquo;) brings its own storage to multi-cluster environments, and in order to make efficient coordination decisions, KCP will identify the following types:</p><h4 id=shared-network-volumes>Shared network-volumes</h4><p>These volumes are provisioned from an external storage system that is available to all/some of the pclusters over an infrastructure network. These volumes are typically provided by a shared-filesystem (aka <a href>NAS</a>), with access-mode of ReadWriteMany (RWX) or ReadOnlyMany (ROX). A shared volume can be used by any pod from any pcluster (that can reach it) at the same time. The application is responsible for the consistency of its data (for example with eventual consistency semantics, or stronger synchronization services like zookeeper). Examples of such storage are generic-NFS/SMB, AWS-EFS, Azure-File, GCP-Filestore, CephFS, GlusterFS, NetApp, GPFS, etc.</p><h4 id=owned-network-volumes>Owned network-volumes</h4><p>These volumes are provisioned from an external storage system that is available to all/some of the pclusters over an infrastructure network. However unlike shared volumes, owned volumes require that only a single node/pod will mount the volume at a time. These volumes are typically provided by a block-level storage system, with access-mode of ReadWriteOnce (RWO) or ReadWriteOncePod (RWOP). It is possible to <em>move</em> the ownership between pclusters (that have access to that storage), by detaching from the current owner, and then attaching to the new owner. But it would have to guarantee a single owner to prevent data inconsistencies or corruptions, and even work if the owner pcluster is offline (see forcing detach with “fencing” below). Examples of such storage are AWS-EBS, Azure-Disk, Ceph-RBD, etc.</p><h4 id=internal-volumes>Internal volumes</h4><p>These volumes are provisioned inside the pcluster itself, and rely on its internal resources (aka hyper-converged or software-defined storage). This means that the availability of the pcluster also determines the availability of the volume. In some systems these volumes are bound to a single node in the pcluster, because the storage is physically attached to a host. However, advanced clustered/distributed systems make efforts to overcome temporary and permanent node failures by adding data redundancy over multiple nodes. These volumes can have any type of access-mode (RWO/RWOP/RWX/ROX), but their strong dependency on the pcluster itself is the key difference from network volumes. Examples of such storage are host-path/local-drives, TopoLVM, Ceph-rook, Portworx, OpenEBS, etc.</p><h2 id=topology-and-locations>Topology and locations</h2><h4 id=regular-topology>Regular topology</h4><p>A regular storage topology is one where every <code>Location</code> is defined so that all of its <code>SyncTargets</code> are connected to the same storage system. This makes it trivial to move network volumes transparently between <code>SyncTargets</code> inside the same location.</p><h4 id=multi-zone-cluster>Multi-zone cluster</h4><p>A more complex topology is where pclusters contain nodes from several availability-zones, for the sake of being resilient to a zone failure. Since volumes are bound to a single zone (where they were provisioned), then a volume will not be able to move between <code>SyncTargets</code> without nodes on that zone. This is ok if all the <code>SyncTargets</code> of the <code>Location</code> span over the same set of zones, but if the zones are different, or the capacity per zone is too limited, copying to another zone might be necessary.</p><h4 id=internal-volumes-1>Internal volumes</h4><p>Internal volumes are always confined to one pcluster, which means it has to be copied outside of the pcluster continuously to keep the application available even in the case where the pcluster fails entirely (network split, region issue, etc). This is similar to how DR solutions work between locations.</p><h4 id=disaster-recover-between-locations>Disaster recover between locations</h4><p>A regular Disaster Recovery (DR) topology will create pairs of <code>Locations</code> so that one is “primary” and the other is “secondary” (sometimes this relation is mutual). For volumes to be able to move between these locations, their storage systems would need to be configured to mirror/replicate/backup/snapshot (whichever approach is more appropriate depends on the case) every volume to its secondary. With such a setup, KCP would need to be able to map between the volumes on the primary and the secondary, so that it could failover and move workloads to the secondary and reconnect to the last copied volume state. See more on the DR section below.</p><h2 id=provisioning-volumes>Provisioning volumes</h2><p>Volume provisioning in Kubernetes involves the CSI controllers and sidecar, as well as a custom storage driver. It reconciles PVCs by dynamically creating a PV for a PVC, and binding them together. This process depends on the CSI driver to be running on the <code>SyncTarget</code> compute resources, and would not be able to run on KCP workspaces. Instead, KCP will pick a designated <code>SyncTarget</code> for the workload placement, which will include the storage claims (PVCs), and the CSI driver on the <code>SyncTarget</code> will perform the storage provisioning.</p><p>In order to support changing workload placement overtime, even if the provisioning <code>SyncTarget</code> is offline, KCP will have to retrieve the volume information from that <code>SyncTarget</code>, and keep it in the KCP workspace for future coordination. The volume information inside the PV is expected to be transferable between <code>SyncTargets</code> that connect to the same storage system and drivers, although some transformations would be required.</p><p>To retrieve the volume information and maintain it in KCP, a special sync state is required that will sync <strong>UP</strong> the PV from a <code>SyncTarget</code> to KCP. This state is referred to as <code>Upsync</code> - see <a href=/kcp/v0.10.0/concepts/locations-and-scheduling/>Resource Upsyncing</a>.</p><p>The provisioning flow includes: (A) PVC synced to <code>SyncTarget</code>, (B) CSI provisioning on the pcluster, (C) Syncer detects PVC binding and initiates PV <code>Upsync</code>. Transformations would be applied in KCP virtual workspace to make sure that the PVC and PV would appear bound in KCP, similar to how it is in a single cluster. Once provisioning itself is complete, coordination logic will switch to a normal <code>Sync</code> state, to allow multiple <code>SyncTargets</code> to share the same volume, and for owned volumes to move ownership to another <code>SyncTarget</code>.</p><h2 id=moving-shared-volumes>Moving shared volumes</h2><p>Shared volume can easily move to any <code>SyncTarget</code> in the same <code>Location</code> by syncing the PVC and PV together, so they bind only to each other on the pcluster. Syncing will transform their mutual references so that the <code>PVC.volumeName = PV.name</code> and <code>PV.claimRef = { PVC.name, PVC.namespace }</code> are set appropriately for the <code>SyncTarget</code>, since the downstream <code>PVC.namespace</code> and <code>PV.name</code> will not be the same as upstream.</p><p>Moving volumes will set the volume&rsquo;s <code>reclaimPolicy</code> to always <code>Retain</code>, to avoid unintended deletion by any one of the <code>SyncTargets</code> while others use it. Once deletion of the upstream PVC is initiated, the coordination controller will transform the <code>reclaimPolicy</code> to <code>Delete</code> for one of the <code>SyncTargets</code>. See more in the section on deleting volumes.</p><h2 id=moving-owned-volumes>Moving owned volumes</h2><blockquote><p><strong>TBD</strong> - this section is a work in progress&mldr;</p></blockquote><h4 id=detach-from-owner>Detach from owner</h4><p>Owned volumes require that <em>at most one</em> pcluster can use them at any given time. As placement changes, the coordination controller is responsible to serialize the state changes of the volume to move the ownership of the volume safely. First, it will detach the volume from the current owner, and wait for it to acknowledge that it successfully removed it, and only then will sync the volume to a new target.</p><h4 id=forcing-detach-with-fencing>Forcing detach with fencing</h4><p>However, in case the owner is not able to acknowledge that it detached the volume, a forced-detach flow might be possible. The storage system has to support a CSI extension for network fencing, effectively blocking an entire pcluster from accessing the storage until fencing is removed. Once the failed pcluster recovers, and can acknowledge that it detached from the moved volumes, fencing will be removed from the storage and that pcluster can recover the rest of its workloads.</p><ul><li><a href>kubernetes-csi-addons</a></li><li><a href>NetworkFence</a> (currently implemented only by ceph-csi).</li></ul><h2 id=storage-classes>Storage classes</h2><blockquote><p><strong>TBD</strong> - this section is a work in progress&mldr;</p></blockquote><p>Storage classes can be thought of as templates to PVs, which allow pclusters to support multiple storage providers, or configure different policies for the same provider. Just like PVs are invisible to users, so do storage classes. However, users may choose a storage class by name when specifying their PVCs. When the storage class field is left unspecified (which is common), the pcluster will use its default storage class. However, the default storage class is a bit limited for multi-tenancy because it is one class per the entire pcluster.</p><p>Matching storage classes between <code>SyncTargets</code> in the same <code>Location</code> would be a simple way to ensure that storage can be moved transparently. However KCP should be able to verify the storage classes match across the <code>Location</code> and warn when this is not the case, to prevent future issues.</p><h4 id=open-questions>Open questions</h4><ul><li>How to match classes and make sure the same storage system is used in the location?</li><li>How to support multiple classes per pcluster (eg. RWO + RWX)?</li><li>Maybe a separate <code>SyncTarget</code> per class?</li><li>Can we have a separate default class per workspace?</li></ul><h2 id=deleting-volumes>Deleting volumes</h2><blockquote><p><strong>TBD</strong> - this section is a work in progress&mldr;</p></blockquote><p><a href>Persistent-volumes reclaiming</a> allows volumes to be configured how to behave when they are reclaimed. By default, storage classes will apply a <code>reclaimPolicy: Delete</code> to dynamically provisioned PVs unless explicitly specified to <code>Retain</code>. This means that volumes there were provisioned, will also get de-provisioned and their storage will be deleted. However, admins can modify the class to <code>Retain</code> volumes, and invoke cleanup on their own schedule.</p><p>While moving volumes, either shared or owned, the volume&rsquo;s <code>reclaimPolicy</code> will be set to <code>Retain</code> to prevent any <code>SyncTarget</code> from releasing the volume storage on scheduling changes.</p><p>Once the PVC is marked for deletion on KCP, the coordination controller will first pick one <code>SyncTarget</code> as owner (or use the current owner for owned volumes) and make sure to remove all sharers, and wait for their sync state to be cleared. Then it will set the owner&rsquo;s volume <code>reclaimPolicy</code> to <code>Delete</code> so that it will release the volume storage.</p><p>Setting a PV to <code>Retain</code> on KCP itself should also be respected by the controllers and allow manual cleanup of the volume in KCP, instead of automatically with the PVC.</p><h2 id=copying-volumes>Copying volumes</h2><blockquote><p><strong>TBD</strong> - this section is a work in progress&mldr;</p></blockquote><ul><li><a href>ramen</a></li><li><a href>volume-replication-operator</a></li><li><a href>volsync</a></li></ul><h2 id=disaster-recovery>Disaster recovery</h2><blockquote><p><strong>TBD</strong> - this section is a work in progress&mldr;</p></blockquote><ul><li>Pairing locations as continuously replicating storage between each other.</li><li>KCP would have to be able to map primary volumes to secondary volumes to failover workloads between locations.</li></ul><h2 id=examples>Examples</h2><blockquote><p><strong>TBD</strong> - this section is a work in progress&mldr;</p></blockquote><h4 id=shared-nfs-storage>Shared NFS storage</h4><ul><li>NFS server running in every location, external to the <code>SyncTarget</code>, but available over the network.</li><li>Note that high-availability and data-protection of the storage itself is out of scope and would be handled by storage admin or provided by enterprise products.</li><li>Workloads allow volumes with RWX access-mode.</li><li>KCP picks one <code>SyncTarget</code> to be the provisioner and syncs up the volume information.</li><li>After provisioning completes, sync down to any <code>SyncTarget</code> in the <code>Location</code> that the workload decides to be placed to allow moving transparently as needed when clusters become offline or drained.</li><li>Once the PVC is deleted, the deletion of the volume itself is performed by one of the <code>SyncTargets</code>.</li></ul><h2 id=roadmap>Roadmap</h2><ul><li>Moving owned volumes</li><li>Fencing</li><li>Copy-on-demand</li><li>Copy-continuous</li><li>DR-location-pairing and primary->secondary volume mapping</li><li>Statefulsets</li><li>COSI Bucket + BucketAccess</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/kcp-users aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/kcp aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/kcp-dev/kcp aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://kubernetes.slack.com/archives/C021U8WSAFK aria-label=Slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/kcp-dev aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 The kcp Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/kcp/js/main.min.83fbb764ebc08886c2d556187c4546dbef0aee3ae9e883e75f70b983b5db1368.js integrity="sha256-g/u3ZOvAiIbC1VYYfEVG2+8K7jrp6IPnX3C5g7XbE2g=" crossorigin=anonymous></script></body></html>